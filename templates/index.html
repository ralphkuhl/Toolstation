<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Handelsadvies</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        h1 { text-align: center; color: #2c3e50; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .advice-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .coin-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; background-color: #fff; }
        .coin-card h2 { margin-top: 0; color: #3498db; }
        .coin-card p { margin: 5px 0; }
        .signal { font-weight: bold; padding: 5px; border-radius: 4px; color: white; text-align: center;}
        .signal-BUY { background-color: #2ecc71; /* Groen */ }
        .signal-SELL { background-color: #e74c3c; /* Rood */ }
        .signal-HOLD { background-color: #f39c12; /* Oranje */ }
        .signal-N_A, .signal-ERROR { background-color: #95a5a6; /* Grijs */ }
        .timestamp { font-size: 0.8em; color: #7f8c8d; margin-top:10px; }
        .loader { text-align: center; padding: 20px; font-size: 1.2em; }
        .error-message { color: #e74c3c; font-weight: bold; }
        ul { list-style-type: none; padding-left: 0;}
        li { padding: 2px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Real-time Crypto Handelsadvies</h1>
        <div id="lastUpdated" class="timestamp" style="text-align: center;">Laden...</div>
        <div id="adviceDisplay" class="advice-grid">
            <div class="loader">Adviezen worden geladen...</div>
        </div>
    </div>

    <script>
        const adviceDisplay = document.getElementById('adviceDisplay');
        const lastUpdatedDisplay = document.getElementById('lastUpdated');

        async function fetchAdvice() {
            try {
                const response = await fetch('/api/advice');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                displayAdvice(data);
            } catch (error) {
                console.error("Fout bij het ophalen van advies:", error);
                adviceDisplay.innerHTML = `<p class="error-message">Kon geen data ophalen. Controleer de console voor details. ${error.message}</p>`;
            }
        }

        function displayAdvice(adviceData) {
            adviceDisplay.innerHTML = ''; // Clear previous content or loader
            let globalLastUpdate = "Nog geen data";

            Object.keys(adviceData).forEach(symbol => {
                const coin = adviceData[symbol];
                const card = document.createElement('div');
                card.className = 'coin-card';

                let signalClass = `signal-${(coin.signal || 'N_A').toUpperCase()}`;
                if (!['signal-BUY', 'signal-SELL', 'signal-HOLD'].includes(signalClass)) {
                    signalClass = 'signal-N_A';
                }

                let indicatorsHTML = '<ul>';
                if (coin.indicators && typeof coin.indicators === 'object' && Object.keys(coin.indicators).length > 0) {
                    for (const [key, value] of Object.entries(coin.indicators)) {
                        indicatorsHTML += `<li><strong>${key.toUpperCase()}:</strong> ${value !== null && value !== undefined ? parseFloat(value).toFixed(2) : 'N/A'}</li>`;
                    }
                } else {
                    indicatorsHTML += '<li>Geen indicator data beschikbaar</li>';
                }
                indicatorsHTML += '</ul>';

                card.innerHTML = `
                    <h2>${symbol}</h2>
                    <p class="signal ${signalClass}">${coin.signal || 'N/A'}</p>
                    <p><strong>Details:</strong> ${coin.details || 'Geen details'}</p>
                    <p><strong>Indicatoren:</strong></p>
                    ${indicatorsHTML}
                `;
                adviceDisplay.appendChild(card);
                if (coin.details && coin.details.includes("Analyzed at")) {
                    globalLastUpdate = coin.details; // Show timestamp from one of the analyses
                }
            });
            lastUpdatedDisplay.textContent = `Laatste update (van server): ${globalLastUpdate}`;
        }

        // Fetch advice when the page loads
        fetchAdvice();

        // Optionally, refresh data every 60 seconds
        setInterval(fetchAdvice, 60000); // 60000 ms = 1 minute
    </script>
</body>
</html>
